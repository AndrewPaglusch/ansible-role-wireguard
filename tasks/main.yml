---
- name: Install WireGuard packages
  package:
    name: wireguard-tools
    state: present
  when: not wireguard_skip_install

- name: Ensure WireGuard directory exists
  file:
    path: /etc/wireguard
    state: directory
    mode: '0755'
    owner: root
    group: root

- name: Create WireGuard configuration file
  template:
    src: wireguard.conf.j2
    dest: "/etc/wireguard/{{ wireguard_interface }}.conf"
    mode: '0600'
    owner: root
    group: root
  notify: restart wireguard

- name: Enable and start WireGuard service
  systemd:
    name: "wg-quick@{{ wireguard_interface }}"
    enabled: yes
    state: started
